<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tienda Online Con Patrones</title>
    <link rel="stylesheet" href="estilos.css"> <!-- Estilos separados -->
</head>
<body>
    <h1>TIENDA ONLINE CON PATRONES DE DISEÑO</h1>
    <!-- Boton para iniciar la demo -->
    <button onclick="iniciarDemo()">Mostrar Productos</button>
    
    <!-- Lugar donde se mostrara el resultado -->
    <pre id="resultado"></pre>

<script>
    // -------------------------------
    // PATRON OBSERVER
    // -------------------------------
    class Observer {
        update(mensaje) {
        // Se espera que las clases hijas implementen este metodo
        console.error("Error: metodo update no implementado");
    }
}

    // Notificador que avisa a sus observadores
    class Notificador {
        constructor() {
            this.observadores = [];
    }

      // Añade un observador a la lista
    suscribir(obs) {
        this.observadores.push(obs);
    }

      // Envia un mensaje a todos los observadores
    notificar(mensaje) {
        this.observadores.forEach(o => o.update(mensaje));
    }
}

    // -------------------------------
    // PATRON FACTORY METHOD
    // -------------------------------
    // Clase base producto con encapsulacion
    class Producto {
        constructor(nombre, precio) {
            this._nombre = nombre;
            this._precio = precio;
    }

    getNombre() { return this._nombre; }
    getPrecio() { return this._precio; }

    mostrarInfo() {
        return this._nombre + " - $" + this._precio;
    }
}

    // Producto electronico extiende Producto
    class ProductoElectronico extends Producto {
        constructor(nombre, precio, garantia) {
            super(nombre, precio);
            this._garantia = garantia;
    }

    mostrarInfo() {
        return super.mostrarInfo() + " (Garantia: " + this._garantia + " meses)";
    }
}

    // Producto ropa extiende Producto
    class ProductoRopa extends Producto {
        constructor(nombre, precio, talla) {
            super(nombre, precio);
            this._talla = talla;
    }

    mostrarInfo() {
        return super.mostrarInfo() + " - Talla: " + this._talla;
    }
}

    // Fabrica para crear productos segun tipo
    class FactoryProducto {
        crear(tipo, nombre, precio, extra) {
            if(tipo === "electronico") {
                return new ProductoElectronico(nombre, precio, extra);
            } else if(tipo === "ropa") {
                return new ProductoRopa(nombre, precio, extra);
            } else {
                return new Producto(nombre, precio);
            }
        }
    }

    // -------------------------------
    // PATRON STRATEGY
    // -------------------------------
    // Clase base para estrategia de pago
    class EstrategiaPago {
        pagar(monto) {
            console.error("Error: pagar() no implementado");
        }
    }

    // Pago con tarjeta
    class PagoTarjeta extends EstrategiaPago {
        pagar(monto) {
            return "Pago con tarjeta: $" + monto;
    }
}

    // Pago con PayPal
    class PagoPayPal extends EstrategiaPago {
        pagar(monto) {
            return "Pago con PayPal: $" + monto;
    }
}

    // -------------------------------
    // Usuario que observa notificaciones
    // -------------------------------
    class Usuario extends Observer {
        constructor(nombre) {
            super();
            this.nombre = nombre;
    }

    update(mensaje) {
        // AquI solo mostramos por consola
        console.log(this.nombre + " recibio: " + mensaje);
      }
    }

    // -------------------------------
    // Carrito simple para productos
    // -------------------------------
    class Carrito {
        constructor() {
            this.productos = [];
    }

    agregar(producto) {
        this.productos.push(producto);
    }

    total() {
        return this.productos.reduce((acc, p) => acc + p.getPrecio(), 0);
    }
}

    // -------------------------------
    // Funcion que arranca la demo
    // -------------------------------
    function iniciarDemo() {
        const factory = new FactoryProducto();
        const notificador = new Notificador();

    // Creamos productos con la fabrica
    const celular = factory.crear("electronico", "Celular", 500, 12);
    const camisa = factory.crear("ropa", "Camisa", 30, "M");

    // Creamos usuarios y los suscribimos al notificador
    const ana = new Usuario("Ana");
    const luis = new Usuario("Luis");
    notificador.suscribir(ana);
    notificador.suscribir(luis);

    // Enviamos notificacion
    notificador.notificar("¡Nuevo producto disponible!");

    // Creamos carrito y agregamos productos
    const carrito = new Carrito();
    carrito.agregar(celular);
    carrito.agregar(camisa);

    // Calculamos total
    const total = carrito.total();

    // Creamos estrategias de pago
    const pagoTarjeta = new PagoTarjeta();
    const pagoPayPal = new PagoPayPal();

    // Mostramos resultados en pantalla
    const texto = `
    Productos:
    - ${celular.mostrarInfo()}
    - ${camisa.mostrarInfo()}
    Usuarios notificados: Ana y Luis
    
    Total del carrito: $${total}
    
    Metodos de pago:
    - ${pagoTarjeta.pagar(total)}
    - ${pagoPayPal.pagar(total)}
    `;
    
    document.getElementById("resultado").textContent = texto;
}
</script>
</body>
</html>
