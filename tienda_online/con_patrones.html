<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tienda Online Con Patrones</title>
    <link rel="stylesheet" href="estilos.css" />
</head>
<body>
    <h1>TIENDA ONLINE CON PATRONES DE DISEÃ‘O</h1>

    <!-- Boton para mostrar productos -->
    <button id="mostrarProductos">Mostrar productos</button>
    
    <!-- Contenedor donde se mostrara el contenido de la tienda -->
    <div id="vistaTienda"></div>

<script>
    // Clase base para productos
    class Producto {
        constructor(nombre, precio) {
            this.nombre = nombre; // Nombre del producto
            this.precio = precio; // Precio del producto
    }

    // Metodo comun para mostrar informacion
    getInfo() {
        return `${this.nombre} - $${this.precio}`;
    }
}

    // Producto tipo electronico (usa herencia)
    class Electronico extends Producto {
        constructor(nombre, precio, garantia) {
            super(nombre, precio); // Llama al constructor de Producto
            this.garantia = garantia; // Garantia especifica
    }

    getInfo() {
        return `${super.getInfo()} (Garantia: ${this.garantia} meses)`;
    }
}

// Producto tipo ropa (usa herencia)
class Ropa extends Producto {
    constructor(nombre, precio, talla) {
        super(nombre, precio); // Llama al constructor base
        this.talla = talla; // Talla especifica
    }

    getInfo() {
        return `${super.getInfo()} - Talla: ${this.talla}`;
    }
}

    // Clase Observador para el patron Observer
    class Observador {
        actualizar(info) {
            console.log("Observador actualizado:", info);
    }
}

    // Clase principal del carrito (Subject del patron Observer)
    class Carrito {
        constructor() {
            this.productos = []; // Lista de productos en el carrito
            this.observadores = []; // Lista de observadores que escuchan los cambios
    }

      // Metodo para agregar productos al carrito
    agregarProducto(producto) {
        this.productos.push(producto); // Agrega el producto a la lista
        this.notificar(); // Llama a los observadores para actualizar la vista
    }

    // Metodo para registrar un observador
    agregarObservador(obs) {
        this.observadores.push(obs);
    }

    // Metodo que notifica a todos los observadores
    notificar() {
        this.observadores.forEach(obs => obs.actualizar(this.productos));
    }

    // Calcula el total del carrito
    getTotal() {
        return this.productos.reduce((total, p) => total + p.precio, 0);
    }
}

// Patron Factory Method para crear productos dependiendo del tipo
class FabricaProducto {
    static crearProducto(tipo, nombre, precio, extra) {
        switch (tipo) {
            case "electronico":
            return new Electronico(nombre, precio, extra);
            
            case "ropa":
            return new Ropa(nombre, precio, extra);
            
            default:
            return new Producto(nombre, precio);
        }
    }
}

// Patron Strategy para aplicar diferentes metodos de pago
class PagoTarjeta {
    pagar(total) {
        return `Pago con tarjeta: $${total}`;
    }
}

    class PagoPayPal {
        pagar(total) {
            return `Pago con PayPal: $${total}`;
    }
}

    // Clase que utiliza el patron Strategy para elegir forma de pago
    class ProcesadorPago {
        constructor(estrategia) {
            this.estrategia = estrategia;
    }

    procesarPago(total) {
        return this.estrategia.pagar(total); // Aplica el metodo seleccionado
    }
}

    // Simula una vista que actua como observador
    class VistaTienda {
        constructor(carrito) {
            this.carrito = carrito;
            carrito.agregarObservador(this); // Se registra como observador
            this.elemento = document.getElementById("vistaTienda");
    }

    // Este metodo se llama automaticamente cuando se agregan productos
    actualizar(productos) {
        this.mostrar(productos);
    }

    mostrar(productos) {
        let contenido = "<h2>Productos:</h2><ul>";
        productos.forEach(p => {
            contenido += `<li>${p.getInfo()}</li>`;
        });
        contenido += "</ul>";

        // Mostrar notificacion de usuarios
        contenido += "<p><strong>Usuarios notificados:</strong> Ana y Luis</p>";

        const total = this.carrito.getTotal();
        contenido += `<p><strong>Total del carrito:</strong> $${total}</p>`;

        // Probar los metodos de pago (Strategy)
        const pagoTarjeta = new ProcesadorPago(new PagoTarjeta());
        const pagoPayPal = new ProcesadorPago(new PagoPayPal());

        contenido += "<p><strong>Metodos de pago:</strong></p><ul>";
        contenido += `<li>${pagoTarjeta.procesarPago(total)}</li>`;
        contenido += `<li>${pagoPayPal.procesarPago(total)}</li>`;
        contenido += "</ul>";

        // Insertar el contenido en la vista
        this.elemento.innerHTML = contenido;
    }
}

    // Crear instancias
    const carrito = new Carrito(); // Carrito vacio
    const vista = new VistaTienda(carrito); // Vista ligada al carrito

    // Simular clic para mostrar productos
    document.getElementById("mostrarProductos").addEventListener("click", () => {
    // Crear productos usando la fabrica
    const celular = FabricaProducto.crearProducto("electronico", "Celular", 500, 12);
    const camisa = FabricaProducto.crearProducto("ropa", "Camisa", 30, "M");

    // Agregar al carrito 
    carrito.agregarProducto(celular);
    carrito.agregarProducto(camisa);
});
</script>
</body>
</html>
