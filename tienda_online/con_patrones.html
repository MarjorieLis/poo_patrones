<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tienda Online Con Patrones</title>
    <link rel="stylesheet" href="estilos.css"> <!-- Estilos separados -->
</head>
<body>
    
    <h1>TIENDA ONLINE CON PATRONES DE DISEÑO</h1>
    
    <!-- Botones para agregar productos -->
    <button onclick="agregarCelular()">Agregar Celular</button>
    <button onclick="agregarCamisa()">Agregar Camisa</button>
    
    <!-- Resultado se muestra aqui -->
    <pre id="resultado"></pre>
<script>
    // -------------------------------
    // PATRON OBSERVER
    // -------------------------------

    // Clase base para observadores
    class Observer {
        update(mensaje) {
            console.error("Error: metodo update no implementado");
    }
}

    // Clase Notificador que maneja los observadores
    class Notificador {
        constructor() {
            this.observadores = []; // Lista de observadores
    }

      // Suscribir nuevos observadores
    suscribir(obs) {
        this.observadores.push(obs);
    }

      // Notificar a todos con un mensaje
    notificar(mensaje) {
        this.observadores.forEach(o => o.update(mensaje));
    }
}

    // -------------------------------
    // PATRON FACTORY METHOD
    // -------------------------------
    // Clase base Producto
    class Producto {
        constructor(nombre, precio) {
            this._nombre = nombre;
            this._precio = precio;
    }

    getNombre() { return this._nombre; }
    getPrecio() { return this._precio; }

    mostrarInfo() {
        return `${this._nombre} - $${this._precio}`;
    }
}

    // Producto Electronico
    class ProductoElectronico extends Producto {
        constructor(nombre, precio, garantia) {
            super(nombre, precio);
            this._garantia = garantia;
    }

    mostrarInfo() {
        return `${super.mostrarInfo()} (Garantia: ${this._garantia} meses)`;
    }
}

    // Producto Ropa
    class ProductoRopa extends Producto {
        constructor(nombre, precio, talla) {
            super(nombre, precio);
            this._talla = talla;
    }

    mostrarInfo() {
        return `${super.mostrarInfo()} - Talla: ${this._talla}`;
    }
}

    // Fabrica de productos
    class FactoryProducto {
        crear(tipo, nombre, precio, extra) {
            if (tipo === "electronico") {
                return new ProductoElectronico(nombre, precio, extra);
            } else if (tipo === "ropa") {
                return new ProductoRopa(nombre, precio, extra);
            } else {
                return new Producto(nombre, precio);
            }
        }
    }

    // -------------------------------
    // PATRON STRATEGY
    // -------------------------------
    // Clase base de estrategia de pago
    class EstrategiaPago {
        pagar(monto) {
            console.error("Error: pagar() no implementado");
    }
}

    // Pago con tarjeta
    class PagoTarjeta extends EstrategiaPago {
        pagar(monto) {
            return `Pago con tarjeta: $${monto}`;
    }
}

    // Pago con PayPal
    class PagoPayPal extends EstrategiaPago {
        pagar(monto) {
            return `Pago con PayPal: $${monto}`;
    }
}

    // -------------------------------
    // OBSERVADOR - USUARIO
    // -------------------------------

    class Usuario extends Observer {
        constructor(nombre) {
            super();
            this.nombre = nombre;
    }

    update(mensaje) {
        console.log(`${this.nombre} recibio: ${mensaje}`);
    }
}

    // -------------------------------
    // CARRITO (con observadores)
    // -------------------------------

    class Carrito {
        constructor() {
            this.productos = [];
            this.observadores = [];
    }

      // Registrar observador del carrito
    registrarObservador(callback) {
        this.observadores.push(callback);
    }

      // Notificar a observadores (actualizar vista)
    notificarObservadores() {
        this.observadores.forEach(cb => cb());
    }

      // Agregar producto y notificar
    agregar(producto) {
        this.productos.push(producto);
        this.notificarObservadores();
    }

      // Calcular total
    total() {
        return this.productos.reduce((acc, p) => acc + p.getPrecio(), 0);
    }

      // Obtener productos
    getProductos() {
        return this.productos;
    }
}

    // -------------------------------
    // VARIABLES GLOBALES
    // -------------------------------

    const factory = new FactoryProducto();
    const carrito = new Carrito();
    const notificador = new Notificador();

    // Usuarios observadores
    const ana = new Usuario("Ana");
    const luis = new Usuario("Luis");
    notificador.suscribir(ana);
    notificador.suscribir(luis);

    // -------------------------------
    // FUNCIONES PARA ACTUALIZAR LA VISTA
    // -------------------------------

    function actualizarVista() {
      // Notificamos a los usuarios (Observer)
    notificador.notificar("¡Se agrego un producto!");

    // Obtener productos y total
    const productos = carrito.getProductos();
    const total = carrito.total();

    // Estrategias de pago
    const pagoTarjeta = new PagoTarjeta();
    const pagoPayPal = new PagoPayPal();

    // Construir texto
    let texto = "Productos:\n";
    productos.forEach(p => {
        texto += `- ${p.mostrarInfo()}\n`;
    });

    texto += `
    Usuarios notificados: Ana y Luis
    Total del carrito: $${total}
    
    Metodos de pago:
    - ${pagoTarjeta.pagar(total)}
    - ${pagoPayPal.pagar(total)}
    `;

    document.getElementById("resultado").textContent = texto;
}

    // Suscribir la vista como observador del carrito
    carrito.registrarObservador(actualizarVista);

    // -------------------------------
    // BOTONES PARA AGREGAR PRODUCTOS
    // -------------------------------

    function agregarCelular() {
        const celular = factory.crear("electronico", "Celular", 500, 12);
        carrito.agregar(celular);
    }

    function agregarCamisa() {
        const camisa = factory.crear("ropa", "Camisa", 30, "M");
        carrito.agregar(camisa);
    }

</script>
</body>
</html>
